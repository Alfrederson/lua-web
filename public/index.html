<!DOCTYPE html>

<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lua Web</title>
    <style>
        body{
            font-family:'Courier New', Courier, monospace;
        }
        button{
            font-size: 1.5em;
        }
    </style>
    <script src="./lua_web.js" type="text/javascript"></script>

    <script>
        const $id = x => document.getElementById(x)

        let output = ""

        // out e err sÃ£o definidas dentro de lua_web.js
        // nÃ£o sei em qual ocasiÃ£o err Ã© chamada
        // out Ã© chamada no "print"
        out = function(x){
            output += x
        }

        err = function(x){
            alert("fug")
        }

        async function compilar(){
            let fonte = $id("in").value
            output = ""
            await Module.ccall("compile", 'number', ['string'], [fonte])
            
            $id("out").innerText = output
        }

        async function rodar(){
            let fonte = $id("in").value
            output = ""
            await Module.ccall("run", 'number', ['string'], [fonte])

            $id("out").innerHTML = output.replaceAll("\r", "<br\>") 
        }

    </script>
  </head>
  <body>
    <h1>Lua Web ðŸŒ™</h1>
    <p>Input:</p>
    <textarea id="in" style="width:100%; height: 128px; font-family:monospace">
for i = 1, 100 do
    if i % 3 == 0 and i % 5 == 0 then
        print("FizzBuzz")
    elseif i % 3 == 0 then
        print("Fizz")
    elseif i % 5 == 0 then
        print("Buzz")
    else
        print(i)
    end
    print("\r")
end
    </textarea>
    <p>Output:</p>
    <div id="out" style="width:100%; height: 128px; overflow-y:auto; margin-bottom:3em; border:1px solid black; font-family:monospace">
    </div>
    <button onclick="compilar()">Compile</button>
    <button onclick="rodar()">Run</button>
  </body>
</html>